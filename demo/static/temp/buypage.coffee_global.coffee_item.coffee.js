/*buypage.coffee*/(function(){var e;e=Backbone.View.extend({events:{"click .save":"save","click .saveToTemp":"saveToTemp","click .getOrderNo":"getOrderNo"},getData:function(){var e,t;return e=this.$el,t={type:"buy",id:e.find(".buyOrderNo span").text(),depot:this.depotSelect.val(),client:this.clientSelect.val()},t=_.extend(t,this.buyItemListView.val())},userLogin:function(e){return e.permissions>4?this.$el.show():void 0},getOrderNo:function(){var e;return e=this.$el,$.get("/orderno?type=jh&cache=false").success(function(t){return t.orderNo?e.find(".buyOrderNo span").text(t.orderNo):void 0})},saveToTemp:function(){return this.post("/tempsave")},save:function(){return this.post("/save")},post:function(e){var t;return null==e&&(e="/save"),t=this.getData(),this.validate(t,function(n){return n?void 0:$.post(e,t).success(function(e){return 0===e.code?(new JT.View.Alert({model:new JT.Model.Dialog({title:"保存成功",content:"<p>保存成功，3秒后自动刷新页面！</p>",btns:{"直接刷新":function(){return window.location.reload()}}})}),_.delay(function(){return window.location.reload()},3e3)):new JT.View.Alert({model:new JT.Model.Dialog({title:"保存失败",content:"<p>保存失败，请重新保存！</p>",btns:{"保存":function(){return self.save()},"取消":function(){}}})})})})},validate:function(e,t){var n;return n=[],e.depot||n.push('<p class="errorText">进货仓库未选择，请先选择！</p>'),e.client||n.push('<p class="errorText">进货客户未选择，请先选择！</p>'),(!e.inputPriceTotal||Math.abs(e.inputPriceTotal-e.priceTotal)>10)&&n.push('<p class="errorText">输入金额为0或者与实际金额相差太大，请确认是否有误！</p>'),n.length?new JT.View.Alert({model:new JT.Model.Dialog({title:"进货单数据有误",content:n.join(""),btns:{"继续保存":function(){return t(null)},"取消保存":function(){}}})}):t(null)},initialize:function(){var e,t;return t=this,e=this.$el,$(document).on("userinfo",function(e,n){return t.userLogin(n)}),this.selectItemListDialog=new JT.View.Dialog({el:e.find(".selectItemsContainer").get(0),model:new JT.Model.Dialog({title:"商品选择列表",btns:{"确定":function(){return t.selectItemListView.select()},"关闭":function(){}}})}),this.buyItemListView=new YS.OrderItemListView({el:e.find(".buyItemsContainer").get(0),model:new YS.OrderItemList,showSelectList:function(e){return t.selectItemListDialog.open(),t.selectItemListView.show(e.trim(),t.depotSelect.val())}}),this.selectItemListView=new YS.SelectItemListView({el:e.find(".selectItemsContainer .content").get(0),model:new YS.SelectItemList,select:function(e){return t.selectItemListDialog.close(),t.buyItemListView.add(e)}}),this.depotSelect=new JT.Collection.Select(DEPOTS),new JT.View.Select({el:e.find(".depot"),tips:"进货仓库",model:this.depotSelect}),this.clientSelect=new JT.Collection.Select([{key:"珠海刘",name:"珠海刘"},{key:"珠海郑",name:"珠海郑"},{key:"珠海谢",name:"珠海谢"}]),new JT.View.Select({el:e.find(".client"),tips:"客户选择",model:this.clientSelect}),this.getOrderNo()}}),jQuery(function(t){var n;return n=new e({el:t("#buyPageContainer").get(0)})})}).call(this);;
/*global.coffee*/(function(){var e,t;window.TIME_LINE.timeEnd("loadjs"),window.TIME_LINE.time("execjs"),e=Backbone.View.extend({events:{"click #logoutBtn":"logout",userinfo:"userLogin","click #loginBtn":"login"},logout:function(){var e;return e=this,$.get("/logout?cache=false").success(function(){return e.userLoginNotify({permissions:-1})})},userLoginNotify:function(e){return $(document).trigger("userinfo",e)},userLogin:function(e,t){var n,i;return n=$("#loginBtn"),i=$("#logoutBtn"),-1===t.permissions?(n.show(),i.hide()):(n.hide(),i.show())},postTimeline:function(){return _.defer(function(){var e;return e=window.TIME_LINE.getLogs(),e.type="timeline",$.post("/statistics",e)})},login:function(){var e;return e=this,async.waterfall([function(e){return window.CryptoJS?e(null,window.CryptoJS):$.getScript("/statics/common/javascripts/utils/sha1.min.js").success(function(){return e(null,window.CryptoJS)})},function(e,t){var n;return n='<div class="loginContainer"><input type="text" class="name" placeholder="请输入用户名" /><br /><input type="password" class="pwd" placeholder="请输入密码" /><br /><p class="errorText infoTip"></p></div>',new JT.View.Alert({model:new JT.Model.Dialog({title:"用户登录",content:n,btns:{"确定":function(n){var i,o;return i=n.find(".name").val(),o=n.find(".pwd").val(),t(null,{name:i,pwd:""+e.SHA1(o)})},"取消":function(){return t(null)}}})})},function(e,t){return e?$.post("/login",e).success(function(e){return t(null,e)}):t(null)}],function(t,n){return n?-1===n.code?new JT.Alert({title:"用户登录",content:"登录出错，是否输入了错误的密码！",btns:{"确定":function(){}}}):e.userLoginNotify(n.data):void 0})},getUserInfo:function(){var e;return e=this,$.get("/userinfo?cache=false").success(function(t){return e.userLoginNotify(t.data)})},initialize:function(){return this.getUserInfo()}}),t={start:function(){var e,t,n;return n=this,e=0,n.timer?void 0:(t=$("#loadingProgressTip").show(),n.timer=window.setInterval(function(){return 100>e?(t.text("正在加载数据，已完成"+e+"%!"),e+=10,$("")):void 0},250))},end:function(){var e;return e=this,window.clearInterval(e.timer),e.timer=null,$("#loadingProgressTip").hide().text("")},init:function(){var e;return e=this,$(document).ajaxStart(function(){return e.start()}),$(document).ajaxComplete(function(){return e.end()})}},jQuery(function(){var n,i;return i=window._,n=window.async,t.init(),window.TIME_LINE.timeEnd("all","html"),new e({el:document})})}).call(this);;
/*item.coffee*/(function(){var e,t;null==(t=window.YS)&&(window.YS={}),e=window.jQuery,YS.BaseItem=Backbone.Model.extend({initialize:function(){}}),YS.ItemListView=Backbone.View.extend({remove:function(e){return this.model.remove(this.model.at(e)),this.render(),this},getTemplate:function(){var e,t;return e=this.fields,t=_.map(e,function(e){return"<td class='"+e.className+"'>"+e.html+"</td>"}),_.template("<tr class='item <%= className %>'>"+t.join("")+"</tr>")},update:function(){return this},getTableHtml:function(){var e,t,n,i,o,r;return i=this,t=function(e){var t;return t="<thead><tr>",_.each(e,function(e){return t+="<th class='"+e.className+"'>"+e.name+"</th>"}),t+="</tr></thead>"},e=function(e){var t,n;return t=function(e){return i.template(e)},n="<tbody>",_.each(e,function(e,i){return e.className=i%2?"odd":"even",n+=t(e)}),n+="</tbody>"},r=t(this.fields),n=this.model.toJSON(),o=e(n),"<div class='theadContainer grayGradient'><table>"+r+"</table></div><div class='tbodyContainer'><table>"+o+"</table></div>"},async:function(e,t){return this.model.at(t).set(e),this.update(),this}})}).call(this);;
